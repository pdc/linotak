import{SvelteComponent as t,init as e,safe_not_equal as n,element as i,svg_element as o,attr as c,xlink_attr as r,insert as h,append as a,action_destroyer as d,listen as l,noop as s,detach as u,run_all as p}from"svelte/internal";import"svelte/internal/disclose-version";function f(){throw new Error("Function called outside component initialization")}function m(t){let e,n;const i=[];function o(i){e=i.clientX,n=i.clientY,t.dispatchEvent(new CustomEvent("panstart",{detail:{x:e,y:n}})),window.addEventListener("mousemove",c),window.addEventListener("mouseup",r)}function c(i){const o=i.clientX-e,c=i.clientY-n;e=i.clientX,n=i.clientY,t.dispatchEvent(new CustomEvent("panmove",{detail:{x:e,y:n,dx:o,dy:c}}))}function r(i){e=i.clientX,n=i.clientY,t.dispatchEvent(new CustomEvent("panend",{detail:{x:e,y:n}})),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",r)}function h(o){for(const t of o.changedTouches)i.push(u(t));if(1===i.length){o.preventDefault();const{clientX:c,clientY:r}=i[0];e=c,n=r,t.dispatchEvent(new CustomEvent("panstart",{detail:{x:e,y:n}})),window.addEventListener("touchmove",a),window.addEventListener("touchend",d),window.addEventListener("touchcancel",l)}}function a(o){for(const t of o.changedTouches){const e=p(t.identifier);e>=0&&(i[e]=u(t))}if(1===i.length){o.preventDefault();const{clientX:c,clientY:r}=i[0],h=c-e,a=r-n;e=c,n=r,t.dispatchEvent(new CustomEvent("panmove",{detail:{x:e,y:n,dx:h,dy:a}}))}}function d(t){s(t)}function l(t){s(t)}function s(o,c){if(1===i.length&&o.changedTouches.length>=1&&o.changedTouches[0].identifier===i[0].identifier){o.preventDefault();const{clientX:i,clientY:c}=o.changedTouches[0];e=i,n=c,t.dispatchEvent(new CustomEvent("pancancel",{detail:{x:e,y:n}})),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",d),window.removeEventListener("touchcancel",l)}for(const t of o.changedTouches){const e=p(t.identifier);e>=0&&i.splice(e,1)}}function u({clientX:t,clientY:e,identifier:n}){return{clientX:t,clientY:e,identifier:n}}function p(t){for(let e=0;e<i.length;++e)if(i[e].identifier===t)return e;return-1}return t.addEventListener("mousedown",o),t.addEventListener("touchstart",h),{destroy(){t.removeEventListener("mousedown",o),t.removeEventListener("touchstart",h)}}}function g(t){let e,n,f,g,w,x,y,E,L,M,$,X,Y,k,T,_,b,H,W,B,C,D,F,I,z,A,S,q,J,N,O,j,G,K,P,Q,R,U,V,Z,tt,et,nt,it,ot,ct;return{c(){e=i("div"),n=o("svg"),f=o("rect"),g=o("image"),L=o("rect"),$=o("rect"),k=o("rect"),H=o("rect"),F=o("circle"),A=o("circle"),J=o("g"),N=o("rect"),P=o("rect"),Z=o("circle"),c(f,"width",t[0]),c(f,"height",t[1]),c(f,"fill",t[9]),r(g,"xlink:href",t[8]),c(g,"x",w=t[17]*t[0]),c(g,"y",x=t[18]*t[1]),c(g,"width",y=t[19]*t[0]),c(g,"height",E=t[20]*t[1]),c(L,"width",t[0]),c(L,"height",M=t[7]*t[1]),c(L,"fill","rgba(0, 0, 0, 0.25)"),c($,"width",t[0]),c($,"y",X=(+t[7]+ +t[5])*t[1]),c($,"height",Y=(1-t[7]-t[5])*t[1]),c($,"fill","rgba(0, 0, 0, 0.25)"),c(k,"width",T=t[6]*t[0]),c(k,"y",_=t[7]*t[1]),c(k,"height",b=t[5]*t[1]),c(k,"fill","rgba(0, 0, 0, 0.25)"),c(H,"x",W=(+t[6]+ +t[4])*t[0]),c(H,"width",B=(1-t[6]-t[4])*t[0]),c(H,"y",C=t[7]*t[1]),c(H,"height",D=t[5]*t[1]),c(H,"fill","rgba(0, 0, 0, 0.25)"),c(F,"cx",I=t[6]*t[0]),c(F,"cy",z=t[7]*t[1]),c(F,"r",v),c(F,"stroke-width","1"),c(F,"stroke","#F30"),c(F,"fill","rgba(255, 51, 0, 0.1)"),c(F,"cursor","move"),c(A,"cx",S=(+t[6]+ +t[4])*t[0]),c(A,"cy",q=(+t[7]+ +t[5])*t[1]),c(A,"r",v),c(A,"stroke-width","1"),c(A,"stroke","#EF0"),c(A,"fill","rgba(238, 255, 0, 0.1)"),c(A,"cursor","nwse-resize"),c(N,"x",O=t[13]+.5),c(N,"y",j=t[14]+.5),c(N,"width",G=t[10]-1),c(N,"height",K=t[11]-1),c(N,"stroke-width","1"),c(N,"stroke","#F56"),c(N,"fill","none"),c(P,"x",Q=t[16]+.5),c(P,"y",R=t[15]+.5),c(P,"width",U=t[12]-1),c(P,"height",V=t[12]-1),c(P,"stroke-width","1"),c(P,"stroke","#0BA"),c(P,"fill","none"),c(Z,"cx",tt=t[2]*t[4]*t[0]),c(Z,"cy",et=t[3]*t[5]*t[1]),c(Z,"r",v),c(Z,"stroke-width","1"),c(Z,"stroke","#B0A"),c(Z,"fill","rgba(187, 0, 170, 0.1)"),c(J,"transform",nt="translate("+t[6]*t[0]+", "+t[7]*t[1]+")"),c(n,"class","im"),c(n,"width",t[0]),c(n,"height",t[1]),c(n,"viewBox",it="0 0 "+t[0]+" "+t[1]),c(e,"class","focus-point")},m(i,o){h(i,e,o),a(e,n),a(n,f),a(n,g),a(n,L),a(n,$),a(n,k),a(n,H),a(n,F),a(n,A),a(n,J),a(J,N),a(J,P),a(J,Z),ot||(ct=[d(m.call(null,F)),l(F,"panmove",t[22]),l(F,"panend",t[24]),d(m.call(null,A)),l(A,"panend",t[24]),l(A,"panmove",t[23]),d(m.call(null,Z)),l(Z,"panmove",t[21])],ot=!0)},p(t,[e]){1&e&&c(f,"width",t[0]),2&e&&c(f,"height",t[1]),512&e&&c(f,"fill",t[9]),256&e&&r(g,"xlink:href",t[8]),1&e&&w!==(w=t[17]*t[0])&&c(g,"x",w),2&e&&x!==(x=t[18]*t[1])&&c(g,"y",x),1&e&&y!==(y=t[19]*t[0])&&c(g,"width",y),2&e&&E!==(E=t[20]*t[1])&&c(g,"height",E),1&e&&c(L,"width",t[0]),130&e&&M!==(M=t[7]*t[1])&&c(L,"height",M),1&e&&c($,"width",t[0]),162&e&&X!==(X=(+t[7]+ +t[5])*t[1])&&c($,"y",X),162&e&&Y!==(Y=(1-t[7]-t[5])*t[1])&&c($,"height",Y),65&e&&T!==(T=t[6]*t[0])&&c(k,"width",T),130&e&&_!==(_=t[7]*t[1])&&c(k,"y",_),34&e&&b!==(b=t[5]*t[1])&&c(k,"height",b),81&e&&W!==(W=(+t[6]+ +t[4])*t[0])&&c(H,"x",W),81&e&&B!==(B=(1-t[6]-t[4])*t[0])&&c(H,"width",B),130&e&&C!==(C=t[7]*t[1])&&c(H,"y",C),34&e&&D!==(D=t[5]*t[1])&&c(H,"height",D),65&e&&I!==(I=t[6]*t[0])&&c(F,"cx",I),130&e&&z!==(z=t[7]*t[1])&&c(F,"cy",z),81&e&&S!==(S=(+t[6]+ +t[4])*t[0])&&c(A,"cx",S),162&e&&q!==(q=(+t[7]+ +t[5])*t[1])&&c(A,"cy",q),8192&e&&O!==(O=t[13]+.5)&&c(N,"x",O),16384&e&&j!==(j=t[14]+.5)&&c(N,"y",j),1024&e&&G!==(G=t[10]-1)&&c(N,"width",G),2048&e&&K!==(K=t[11]-1)&&c(N,"height",K),65536&e&&Q!==(Q=t[16]+.5)&&c(P,"x",Q),32768&e&&R!==(R=t[15]+.5)&&c(P,"y",R),4096&e&&U!==(U=t[12]-1)&&c(P,"width",U),4096&e&&V!==(V=t[12]-1)&&c(P,"height",V),21&e&&tt!==(tt=t[2]*t[4]*t[0])&&c(Z,"cx",tt),42&e&&et!==(et=t[3]*t[5]*t[1])&&c(Z,"cy",et),195&e&&nt!==(nt="translate("+t[6]*t[0]+", "+t[7]*t[1]+")")&&c(J,"transform",nt),1&e&&c(n,"width",t[0]),2&e&&c(n,"height",t[1]),3&e&&it!==(it="0 0 "+t[0]+" "+t[1])&&c(n,"viewBox",it)},i:s,o:s,d(t){t&&u(e),ot=!1,p(ct)}}}const v=32;function w(t,e,n){return e>n*t?[n*t,n]:[e,e/t]}function x(t,e,n){let i,o,c,r,h,a,{src:d}=e,{width:l}=e,{height:s}=e,{focusX:u=.5}=e,{focusY:p=.5}=e,{cropLeft:m=0}=e,{cropTop:g=0}=e,{cropWidth:x=1}=e,{cropHeight:y=1}=e,{placeholder:E="#999"}=e;const L=m,M=g,$=x,X=y,Y=function(){const t=f();return(e,n,{cancelable:i=!1}={})=>(t.$$.callbacks[e],!0)}();let k,T;var _;_=()=>{const t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;(l>t||s>e)&&(l/s<t/e?(n(0,l*=e/s),n(1,s=e)):(n(1,s*=t/l),n(0,l=t)))},f().$$.on_mount.push(_);return t.$$set=t=>{"src"in t&&n(8,d=t.src),"width"in t&&n(0,l=t.width),"height"in t&&n(1,s=t.height),"focusX"in t&&n(2,u=t.focusX),"focusY"in t&&n(3,p=t.focusY),"cropLeft"in t&&n(6,m=t.cropLeft),"cropTop"in t&&n(7,g=t.cropTop),"cropWidth"in t&&n(4,x=t.cropWidth),"cropHeight"in t&&n(5,y=t.cropHeight),"placeholder"in t&&n(9,E=t.placeholder)},t.$$.update=()=>{51&t.$$.dirty&&n(12,[i,o]=w(1,x*l,y*s),i,(n(25,o),n(4,x),n(0,l),n(5,y),n(1,s))),4117&t.$$.dirty&&n(16,c=u*(x*l-i)),33554474&t.$$.dirty&&n(15,r=p*(y*s-o)),51&t.$$.dirty&&n(10,[h,a]=w(16/9,x*l,y*s),h,(n(11,a),n(4,x),n(0,l),n(5,y),n(1,s))),3135&t.$$.dirty&&(h===x*l?(n(13,k=0),n(14,T=Math.min(y*s-a,Math.max(0,p*y*s-.5*a)))):(n(13,k=Math.min(x*l-h,Math.max(0,u*x*l-.5*h))),n(14,T=0)))},[l,s,u,p,x,y,m,g,d,E,h,a,i,k,T,r,c,L,M,$,X,function(t){n(2,u=Math.max(Math.min(1,+u+t.detail.dx/l),0)),n(3,p=Math.max(Math.min(1,+p+t.detail.dy/s),0)),Y("focuspointchange",{focusX:u,focusY:p})},t=>{const e=+m+t.detail.dx/l;n(6,m=Math.max(Math.min(1-v/l,e),0));const i=+g+t.detail.dy/s;n(7,g=Math.max(Math.min(1-v/s,i),0)),n(4,x=Math.max(Math.min(1-m,+x),v/l)),n(5,y=Math.max(Math.min(1-g,+y),v/l))},t=>{const e=+x+t.detail.dx/l;n(4,x=Math.max(Math.min(1-m,e),v/l));const i=+y+t.detail.dy/s;n(5,y=Math.max(Math.min(1-g,i),v/s))},t=>{Y("cropchange",{cropLeft:m,cropTop:g,cropWidth:x,cropHeight:y})},o]}const y=document.getElementById("focus-ui-form"),E=document.getElementById("focus-ui"),L=E.querySelector("img"),M=L.src;L.remove();const{width:$,height:X,placeholder:Y}=JSON.parse(document.getElementById("imageData").text),k={focusX:y.focus_x.value,focusY:y.focus_y.value},T={cropLeft:y.crop_left.value,cropTop:y.crop_top.value,cropWidth:y.crop_width.value,cropHeight:y.crop_height.value},_=new class extends t{constructor(t){super(),e(this,t,x,g,n,{src:8,width:0,height:1,focusX:2,focusY:3,cropLeft:6,cropTop:7,cropWidth:4,cropHeight:5,placeholder:9})}}({target:E,props:{src:M,width:$,height:X,...k,...T,placeholder:Y}});_.$on("focuspointchange",(t=>{const{detail:{focusX:e,focusY:n}}=t;y.focus_x.value=e,y.focus_y.value=n})),_.$on("cropchange",(t=>{const{detail:{cropLeft:e,cropTop:n,cropWidth:i,cropHeight:o}}=t;console.log("cropchange",e,n,i,o),y.crop_left.value=e,y.crop_top.value=n,y.crop_width.value=i,y.crop_height.value=o}));export{_ as default};
//# sourceMappingURL=bundle.js.map
